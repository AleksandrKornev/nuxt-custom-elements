language: node_js
branches:
  except:
    - /^v\d+\.\d+\.\d+$/
env:
  global:
    # github
    - secure: nMlzQNgmFOxT2wuiksJmLrK0aJjy3SUlc2ZBcFV4FvHwufYM11g5wW1ko5+DFBInI3U+kKxm0sDazvgImYG4U8bZNKRjW6dLOlRr3JR10dI/6OICr0obt0Yb8cj+sp6adP4Ne+Hbj+dZRtU3XGakzE33ihz/iwzivHA1ApoegbUJdD4A1yr34j2CrdU+X2zQhMhZVWGlDykvMsObJidGymvJtOx5uvI9eXjwdbxiyh8yGlpV6RlbpQBvkX6hOIeddu3TGzYzqsrCNEAkYKY/gWQIQ+lrRkuwMdxhJlaCqPmR2DvpumQds6yJu9mZwuHJGECi58l+Z+GbwGcIQ4B3vZcAGbS5Fjq2AspTTdGIQ+3MBr7uL6YCytWvRAfWApl8pe5wJCGldWGbDWfIr2O3dbsC1XQw5+ItmxBDpvMM8oN8MWJX/MzxDIH3UDGk4s1UocfnDdx2ryn4zp+QnZtgfJDZPvYVimpihoNqxnB9wRP38+L1XKtCMPOqNzIJkXRSRb5qOvP4UlUhCGVFkuzQkgI+csnHjU6AXFDzBnS/Zw1oHNK5u1IRNapoJn5G1pe/LC3BzXaU816SlwFoMwJRhyxGR53sd9KtRBRGCkVgWy/TtU4hbs8/BFjGFNWnJIHJYdeBf9DLkE+ZYszzTWA5WQK+BNeelwMR2XUgDzLJ4CM=
    # npm
    - secure: 6i/LxwUJv5QaKornJtJtQ6NlSIKfD8fjE2YQrBLZsAnYYEo6zOJPUNzTtr2ve6bgiiAkecCeyo9rmWJ/cv1Qjn3kHELRIdlp/hoPTz5b2JOC+u1kvkyKLDd3zPA322mfS9/6oxrWCMWcl7/o4C/0FMRKjhqneoBeXvgAyyNQRffgP+EU6D1llF3aw73pd4bfpbxWo80GbTgTXpNk1NYPXHF+x4t0URzExGrcwyW90ul0/9KzhAKuSBS1yli0xItJ/k47hXJplfEgjAcZSsbQEyiZrRyKY0ExSGXGBHDsdTfvbQIuwMVCIPBt1b20CBC+phYd2qeScHDvQgZmfZadMTDP3uc84w9dHNbOeeMEsGTcIMj9ktxIJj505TXaOoOUzr45mn/0TQkiNMDjaMH9B87Pgz7G6M1gyObqp7lMvECL33wrw5jotVwP8UHGTEFAE1S5PfBUwpeKr+ppbMdVz/NNV1JmGJWaeo+D8BxhZ9rczoWJt0+cYscO7Oa5mnRcReoR6QjLqS43OU0N7ZjK4+0Q4qoJf/4K4gfe/NS7oVoTvhY+VoeOr8Wv0CPHxI6nOoSXMhweRPGNmS0uli7Z7xAAh71mq5TTASqJmIMDHP7sQCdJmLHJPdvyc+6MkAbIgRSwmxzpdTbH3jdDI8xqJQ8wz6Nyhpj14QTT0epJ51Q=
cache:
  npm: true
  directories:
    - dist
    - reports
jobs:
  include:
    - stage: prepare cache
      name: install
      before_install:
        - rm -rf dist reports
      install:
        - npm i
    - stage: website
      name: build
      script:
        # - echo $TRAVIS_PULL_REQUEST_BRANCH
        # - echo $TRAVIS_BRANCH
        # - echo $TRAVIS_COMMIT
        # - echo $TRAVIS_PULL_REQUEST_SHA
        - if [ -z "$TRAVIS_PULL_REQUEST_BRANCH" ]; then export PT_BRANCH=$TRAVIS_BRANCH; else export PT_BRANCH=$TRAVIS_PULL_REQUEST_BRANCH; fi
        - if [ -z "$TRAVIS_PULL_REQUEST_SHA" ]; then export PT_COMMIT=$TRAVIS_COMMIT; else export PT_COMMIT=$TRAVIS_PULL_REQUEST_SHA; fi
        # - echo $PT_COMMIT
        # - echo $PT_BRANCH
        - npm run build --base=/nuxt-custom-elements/
    - stage: deploy
      if: branch = master
      install:
        - npm i semantic-release @semantic-release/exec @semantic-release/git @semantic-release/changelog --no-save
      script:
        - npx semantic-release --provider=github
        - mkdir gh-pages gh-pages/reports
        - cp -R dist/nuxt-custom-elements/* gh-pages/
        - cp -R reports/* gh-pages/reports/
        - touch gh-pages/.nojekyll
      deploy:
        provider: pages
        cleanup: false
        github_token: $GH_TOKEN
        local_dir: gh-pages/
        on:
          branch: master
        edge: true


